v<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Fee Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; margin: 10px; background: #f0f2f5; color: #333; }
  h2 { text-align: center; font-size: 24px; margin-bottom: 15px; }
  
  .controls { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-bottom: 10px; }
  input, select, button { font-size: 14px; padding: 6px; border-radius: 5px; border: 1px solid #ccc; }
  button { cursor: pointer; background: #3498db; color: white; border: none; transition: 0.2s; }
  button:hover { opacity: 0.85; }

  .totals { margin-top: 15px; display: flex; justify-content: space-between; font-weight: bold; flex-wrap: wrap; }
  .totals .paid { color: green; }
  .totals .unpaid { color: red; }

  .table-container { overflow-x: auto; max-width: 100%; margin-bottom: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 8px; }
  table { border-collapse: collapse; width: 100%; font-size: 14px; background: white; border-radius: 8px; overflow: hidden; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; white-space: nowrap; }
  th { background: #f2f2f2; position: sticky; top: 0; z-index: 1; cursor: pointer; }
  tbody tr:nth-child(even) { background: #f9f9f9; }
  tbody tr:hover { background: #e8f0fe; }

  .badge { padding: 2px 6px; border-radius: 4px; color: white; font-weight: bold; font-size: 12px; margin-left: 4px; }
  .paid-badge { background: green; }
  .unpaid-badge { background: red; }
  .advance-yes { background: #3498db; }
  .advance-no { background: gray; }

  td.paid-cell { background-color: #d4f8d4; }
  td.unpaid-cell { background-color: #f8d4d4; }
  td.advance-yes-cell { background-color: #d0e7ff; }
  td.advance-no-cell { background-color: #e0e0e0; }
  td.today { background-color: #fff3b0 !important; }

  @media (max-width: 500px) {
    table, thead, tbody, th, td, tr { display: block; }
    th { display: none; }
    td { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #ccc; }
    td::before { content: attr(data-label); font-weight: bold; }
    .controls { flex-direction: column; gap: 5px; }
    .totals { flex-direction: column; gap: 5px; }
    input, select, button { font-size: 16px; padding: 8px; }
    .delBtn { padding: 6px 10px; }
  }
</style>
</head>
<body>

<h2>üìò Student Fee Dashboard</h2>

<div class="controls">
  <label for="monthSelect">Month:</label>
  <select id="monthSelect"></select>
  <button onclick="saveData()">üíæ Save</button>
  <button onclick="newMonth()">‚ûï New Month</button>
  <button onclick="clearMonth()">üóëÔ∏è Clear Month</button>
  <button onclick="exportCSV()">üì• Export CSV</button>
  <input type="text" id="searchInput" placeholder="Search Name or Class" oninput="filterRows()">
</div>

<div class="table-container">
  <table id="feeTable">
    <thead>
      <tr>
        <th onclick="sortTable(0)">No.</th>
        <th onclick="sortTable(1)">Student's Name</th>
        <th onclick="sortTable(2)">Class</th>
        <th onclick="sortTable(3)">Joining Date</th>
        <th onclick="sortTable(4)">Fixed Fee</th>
        <th onclick="sortTable(5)">Advance Fee</th>
        <th onclick="sortTable(6)">Fee Paid</th>
        <th onclick="sortTable(7)">Payment Date</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<button onclick="addRow()">‚ûï Add Student</button>

<div class="totals">
  <div class="unpaid">Unpaid Total: <span id="unpaidTotal">0</span></div>
  <div class="paid">Paid Total: <span id="paidTotal">0</span></div>
</div>

<script>
const monthSelect = document.getElementById("monthSelect");
const tableBody = document.getElementById("tableBody");
const searchInput = document.getElementById("searchInput");
let currentMonth = getCurrentMonth();

function getCurrentMonth() {
  const today = new Date();
  return today.toLocaleString("default", { month: "long", year: "numeric" });
}

function populateMonths() {
  monthSelect.innerHTML = "";
  let keys = Object.keys(localStorage).filter(k => k.startsWith("studentFee_"));
  keys.forEach(k => {
    let month = k.replace("studentFee_", "");
    let opt = document.createElement("option");
    opt.value = month;
    opt.textContent = month;
    monthSelect.appendChild(opt);
  });
  if (!keys.includes("studentFee_" + currentMonth)) {
    let opt = document.createElement("option");
    opt.value = currentMonth;
    opt.textContent = currentMonth;
    monthSelect.appendChild(opt);
  }
  monthSelect.value = currentMonth;
}

function addRow(data = {}) {
  let row = document.createElement("tr");
  row.innerHTML = `
    <td data-label="No."></td>
    <td data-label="Student's Name"><input type="text" value="${data.name || ""}"></td>
    <td data-label="Class"><input type="text" value="${data.class || ""}"></td>
    <td data-label="Joining Date"><input type="date" value="${data.joinDate || ""}"></td>
    <td data-label="Fixed Fee"><input type="number" value="${data.fixedFee || ""}" min="0" oninput="updateTotals()"></td>
    <td data-label="Advance Fee" onclick="toggleCell(this)"><span class="cell-text">${data.advance || "No"}</span></td>
    <td data-label="Fee Paid" onclick="toggleCell(this)"><span class="cell-text">${data.paid || "No"}</span></td>
    <td data-label="Payment Date"><input type="date" value="${data.paymentDate || ""}" readonly></td>
    <td data-label="Action"><button class="delBtn" onclick="deleteRow(this)">‚ùå</button></td>
  `;
  tableBody.appendChild(row);
  updateRowNumbers();
  updateCellColors(row);
  updateTotals();
  highlightTodayPayments();
  filterRows();
}

function updateRowNumbers() {
  tableBody.querySelectorAll("tr").forEach((row, index) => row.cells[0].textContent = index + 1);
}

function toggleCell(td) {
  const span = td.querySelector(".cell-text");
  let value = span.textContent;
  if(td.dataset.label === "Fee Paid"){
    value = value === "Yes" ? "No" : "Yes";
    span.textContent = value;
    td.parentElement.cells[7].querySelector("input").value = value==="Yes"? new Date().toISOString().split("T")[0] : "";
  } else if(td.dataset.label === "Advance Fee"){
    value = value === "Yes" ? "No" : "Yes";
    span.textContent = value;
  }
  updateCellColors(td.parentElement);
  updateTotals();
  highlightTodayPayments();
  filterRows();
}

function updateCellColors(row){
  const advanceTd = row.cells[5];
  const paidTd = row.cells[6];
  advanceTd.className = "";
  advanceTd.classList.add(advanceTd.querySelector(".cell-text").textContent==="Yes"? "advance-yes-cell":"advance-no-cell");
  paidTd.className = "";
  paidTd.classList.add(paidTd.querySelector(".cell-text").textContent==="Yes"? "paid-cell":"unpaid-cell");
}

function deleteRow(btn){
  if(confirm("Delete this student?")) btn.parentElement.parentElement.remove();
  updateRowNumbers();
  updateTotals();
  highlightTodayPayments();
}

function saveData(){
  const rows = tableBody.querySelectorAll("tr");
  const data = [];
  rows.forEach(r => {
    data.push({
      name: r.cells[1].querySelector("input").value,
      class: r.cells[2].querySelector("input").value,
      joinDate: r.cells[3].querySelector("input").value,
      fixedFee: r.cells[4].querySelector("input").value,
      advance: r.cells[5].querySelector(".cell-text").textContent,
      paid: r.cells[6].querySelector(".cell-text").textContent,
      paymentDate: r.cells[7].querySelector("input").value
    });
  });
  localStorage.setItem("studentFee_" + monthSelect.value, JSON.stringify(data));
  alert("Data saved for "+monthSelect.value);
  populateMonths();
}

function loadData(month){
  tableBody.innerHTML="";
  const saved = localStorage.getItem("studentFee_" + month);
  if(saved) JSON.parse(saved).forEach(r=>addRow(r));
  else addRow();
  updateTotals();
  highlightTodayPayments();
  filterRows();
}

function newMonth(){
  const keys = Object.keys(localStorage).filter(k=>k.startsWith("studentFee_"));
  let lastMonth = keys.length? keys.map(k=>k.replace("studentFee_","")).sort().pop():currentMonth;
  const [monthName, year] = lastMonth.split(" ");
  const monthIndex = new Date(Date.parse(monthName+" 1, 2025")).getMonth();
  const nextMonthDate = new Date(year, monthIndex+1, 1);
  currentMonth = nextMonthDate.toLocaleString("default",{month:"long",year:"numeric"});
  tableBody.innerHTML="";
  addRow();
  saveData();
  loadData(currentMonth);
}

function clearMonth(){
  if(confirm("Delete all data for "+monthSelect.value+"?")){
    localStorage.removeItem("studentFee_"+monthSelect.value);
    populateMonths();
    currentMonth = monthSelect.value = monthSelect.options[0]?.value || getCurrentMonth();
    loadData(currentMonth);
  }
}

function exportCSV(){
  const rows = tableBody.querySelectorAll("tr");
  if(!rows.length){ alert("No data to export!"); return; }
  let csv = "No.,Student's Name,Class,Joining Date,Fixed Fee,Advance Fee,Fee Paid,Payment Date\n";
  rows.forEach((r,i)=>{
    const rowData = [
      i+1,
      r.cells[1].querySelector("input").value,
      r.cells[2].querySelector("input").value,
      r.cells[3].querySelector("input").value,
      r.cells[4].querySelector("input").value,
      r.cells[5].querySelector(".cell-text").textContent,
      r.cells[6].querySelector(".cell-text").textContent,
      r.cells[7].querySelector("input").value
    ];
    csv += rowData.join(",")+"\n";
  });
  const blob = new Blob([csv],{type:"text/csv;charset=utf-8;"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = monthSelect.value+".csv";
  link.click();
}

function updateTotals(){
  let paid=0,unpaid=0;
  tableBody.querySelectorAll("tr").forEach(r=>{
    const fee = parseInt(r.cells[4].querySelector("input").value||0);
    const status = r.cells[6].querySelector(".cell-text").textContent;
    status==="Yes"?paid+=fee:unpaid+=fee;
  });
  document.getElementById("paidTotal").textContent=paid;
  document.getElementById("unpaidTotal").textContent=unpaid;
}

function highlightTodayPayments(){
  const today = new Date().toISOString().split("T")[0];
  tableBody.querySelectorAll("tr").forEach(r=>{
    const pd = r.cells[7].querySelector("input").value;
    if(pd===today) r.cells[7].classList.add("today");
    else r.cells[7].classList.remove("today");
  });
}

// üîπ Search/filter
function filterRows(){
  const query = searchInput.value.toLowerCase();
  tableBody.querySelectorAll("tr").forEach(r=>{
    const name = r.cells[1].querySelector("input").value.toLowerCase();
    const cls = r.cells[2].querySelector("input").value.toLowerCase();
    r.style.display = (name.includes(query) || cls.includes(query)) ? "" : "none";
  });
  updateTotals();
}

// üîπ Sort table
function sortTable(colIndex){
  const rowsArray = Array.from(tableBody.querySelectorAll("tr"));
  const asc = tableBody.dataset.sortCol !== colIndex || tableBody.dataset.sortOrder==="desc";
  rowsArray.sort((a,b)=>{
    let valA = colIndex<=4? parseFloat(a.cells[colIndex].querySelector("input")?.value||0) : a.cells[colIndex].querySelector(".cell-text")?.textContent || a.cells[colIndex].querySelector("input")?.value || "";
    let valB = colIndex<=4? parseFloat(b.cells[colIndex].querySelector("input")?.value||0) : b.cells[colIndex].querySelector(".cell-text")?.textContent || b.cells[colIndex].querySelector("input")?.value || "";
    if(valA<valB) return asc? -1:1;
    if(valA>valB) return asc? 1:-1;
    return 0;
  });
  rowsArray.forEach(r=>tableBody.appendChild(r));
  updateRowNumbers();
  tableBody.dataset.sortCol=colIndex;
  tableBody.dataset.sortOrder=asc?"asc":"desc";
  filterRows();
}

monthSelect.addEventListener("change",()=>{ currentMonth=monthSelect.value; loadData(currentMonth); });

populateMonths(); loadData(currentMonth);
</script>
</body>
</html>
